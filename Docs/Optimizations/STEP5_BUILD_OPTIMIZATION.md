# –≠—Ç–∞–ø 5: Build –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ó–ê–í–ï–†–®–Å–ù ‚úÖ

**–î–∞—Ç–∞**: 30.09.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–≠–∫–æ–Ω–æ–º–∏—è**: ~1-2 MB (ProGuard) + ~40-50% —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–∂–¥–æ–≥–æ APK (splits)

---

## üìä –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### ‚úÖ 5.1: ProGuard –ø—Ä–∞–≤–∏–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù–û)
**–§–∞–π–ª**: `app/proguard-rules.pro`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
   ```proguard
   -optimizations !code/simplification/arithmetic,!code/simplification/cast,!field/*,!class/merging/*
   -optimizationpasses 5
   -allowaccessmodification
   -repackageclasses ''
   ```

2. **–£–¥–∞–ª–µ–Ω–∏–µ debug –ª–æ–≥–æ–≤ –∏–∑ release**:
   ```proguard
   -assumenosideeffects class android.util.Log {
       public static *** d(...);
       public static *** v(...);
       public static *** i(...);
   }
   
   -assumenosideeffects class timber.log.Timber {
       public static *** d(...);
       public static *** v(...);
       public static *** i(...);
   }
   ```

3. **–£–¥–∞–ª–µ–Ω—ã Gson –ø—Ä–∞–≤–∏–ª–∞** (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å—Ç—å kotlinx.serialization)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ~1-2 MB —ç–∫–æ–Ω–æ–º–∏–∏ ‚≠ê

---

### ‚úÖ 5.2: APK Splits (–ó–ê–í–ï–†–®–ï–ù–û)
**–§–∞–π–ª**: `app/build.gradle.kts`

#### ABI Splits - –æ—Ç–¥–µ–ª—å–Ω—ã–µ APK –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä:
```kotlin
splits {
    abi {
        isEnable = true
        reset()
        include("arm64-v8a", "armeabi-v7a", "x86_64")
        isUniversalApk = true // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π APK –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    }
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**:
- ‚úÖ `arm64-v8a` - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ 64-–±–∏—Ç–Ω—ã–µ ARM —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (90% —Ä—ã–Ω–∫–∞)
- ‚úÖ `armeabi-v7a` - —Å—Ç–∞—Ä—ã–µ 32-–±–∏—Ç–Ω—ã–µ ARM —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (8% —Ä—ã–Ω–∫–∞)
- ‚úÖ `x86_64` - Intel —ç–º—É–ª—è—Ç–æ—Ä—ã –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞–Ω—à–µ—Ç—ã (2% —Ä—ã–Ω–∫–∞)
- ‚úÖ `universal` - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π APK –¥–ª—è –≤—Å–µ—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

**–≠–∫–æ–Ω–æ–º–∏—è**: –ö–∞–∂–¥—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π APK –±—É–¥–µ—Ç –Ω–∞ **~30-40% –º–µ–Ω—å—à–µ** —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ!

#### Density Splits - –æ—Ç–¥–µ–ª—å–Ω—ã–µ APK –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π:
```kotlin
splits {
    density {
        isEnable = true
        reset()
        include("mdpi", "hdpi", "xhdpi", "xxhdpi", "xxxhdpi")
    }
}
```

**–ü–ª–æ—Ç–Ω–æ—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞**:
- `mdpi` - 160dpi (—Å—Ç–∞—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- `hdpi` - 240dpi (–±—é–¥–∂–µ—Ç–Ω—ã–µ)
- `xhdpi` - 320dpi (—Å—Ä–µ–¥–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç)
- `xxhdpi` - 480dpi (—Ñ–ª–∞–≥–º–∞–Ω—ã 2018-2020)
- `xxxhdpi` - 640dpi (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–ª–∞–≥–º–∞–Ω—ã)

**–≠–∫–æ–Ω–æ–º–∏—è**: –ö–∞–∂–¥—ã–π density-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π APK –±—É–¥–µ—Ç –Ω–∞ **~10-15% –º–µ–Ω—å—à–µ**!

---

### ‚úÖ 5.3: Lite Flavor –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù–û)
**–§–∞–π–ª**: `app/build.gradle.kts`

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è Lite –≤–µ—Ä—Å–∏–∏:
```kotlin
create("lite") {
    dimension = "version"
    applicationIdSuffix = ".lite"
    versionNameSuffix = "-lite"
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤
    resConfigs("ru", "en")
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ –≤—ã—Å–æ–∫–∏–µ)
    resConfigs("xxhdpi", "xxxhdpi")
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç**:
- **–Ø–∑—ã–∫–∏**: —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (—É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –¥—Ä—É–≥–∏–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫)
- **–ü–ª–æ—Ç–Ω–æ—Å—Ç–∏**: —Ç–æ–ª—å–∫–æ xxhdpi –∏ xxxhdpi (–¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
- **–†–∞–∑–º–µ—Ä Lite APK**: –Ω–∞ **~15-20% –º–µ–Ω—å—à–µ** Full –≤–µ—Ä—Å–∏–∏

---

## üí∞ –ò–¢–û–ì–û–í–ê–Ø –≠–ö–û–ù–û–ú–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë–µ–∑ Splits (–æ–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞)
| –í–µ—Ä—Å–∏—è | –†–∞–∑–º–µ—Ä | –≠–∫–æ–Ω–æ–º–∏—è –æ—Ç ProGuard |
|--------|--------|---------------------|
| Full Release | ~8-10 MB | ~1-2 MB ‚≠ê |
| Lite Release | ~6.5-8 MB | ~1-2 MB + 15-20% |

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ Splits (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) üöÄ
| APK | –†–∞–∑–º–µ—Ä | –≠–∫–æ–Ω–æ–º–∏—è |
|-----|--------|----------|
| **Full + arm64-v8a + xxhdpi** | ~4-5 MB | **~50% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞!** ‚≠ê‚≠ê‚≠ê |
| **Lite + arm64-v8a + xxhdpi** | ~3-4 MB | **~60% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞!** ‚≠ê‚≠ê‚≠ê |
| Full + armeabi-v7a + hdpi | ~4-5 MB | ~50% |
| Universal (–≤—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã) | ~8-10 MB | ~20% |

**–ì–ª–∞–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å APK –≤ **2-3 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ**! üéâ

---

## üì¶ –ö–ê–ö –°–û–ë–†–ê–¢–¨ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï APK

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å–µ APK —Å—Ä–∞–∑—É (—Å splits)
```bash
./gradlew clean
./gradlew assembleFullRelease
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç** (–≤ `app/build/outputs/apk/full/release/`):
- `app-full-arm64-v8a-release.apk` (~4 MB)
- `app-full-armeabi-v7a-release.apk` (~4 MB)
- `app-full-x86_64-release.apk` (~4.5 MB)
- `app-full-universal-release.apk` (~8 MB, —Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- Density variants –¥–ª—è –∫–∞–∂–¥–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –í–∞—Ä–∏–∞–Ω—Ç 2: Lite –≤–µ—Ä—Å–∏—è
```bash
./gradlew assembleLiteRelease
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ï—â—ë –º–µ–Ω—å—à–∏–µ APK (~3-4 MB –∫–∞–∂–¥—ã–π)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ë–µ–∑ splits (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ `build.gradle.kts`:
```kotlin
splits {
    abi {
        isEnable = false // –û—Ç–∫–ª—é—á–∏—Ç—å
    }
    density {
        isEnable = false // –û—Ç–∫–ª—é—á–∏—Ç—å
    }
}
```

---

## üìä –ò–ó–ú–ï–†–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

### –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã:
```powershell
# PowerShell
ls -lh app\build\outputs\apk\full\release\*.apk | Select-Object Name, Length | Format-Table
```

### –ê–Ω–∞–ª–∏–∑ –≤ Android Studio:
```
Build ‚Üí Analyze APK...
–í—ã–±—Ä–∞—Ç—å: app-full-arm64-v8a-release.apk
```

**–°—Ä–∞–≤–Ω–∏—Ç—å**:
- `lib/` - —Ç–æ–ª—å–∫–æ arm64-v8a –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä)
- `res/` - —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ density —Ä–µ—Å—É—Ä—Å—ã
- `classes.dex` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω ProGuard

---

## ‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Splits:

#### ABI Splits:
Yandex MapKit —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- `lib/arm64-v8a/libYandexMapKit.so` (~15 MB)
- `lib/armeabi-v7a/libYandexMapKit.so` (~12 MB)
- `lib/x86_64/libYandexMapKit.so` (~18 MB)

**–ë–µ–∑ splits**: –≤—Å–µ 3 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (~45 MB) –≤ –æ–¥–Ω–æ–º APK  
**–°–æ splits**: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (~12-18 MB) –≤ –∫–∞–∂–¥–æ–º APK  
**–≠–∫–æ–Ω–æ–º–∏—è**: ~30 MB –Ω–∞ –∫–∞–∂–¥–æ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–º APK!

#### Density Splits:
Launcher icons –∏ –¥—Ä—É–≥–∏–µ —Ä–∞—Å—Ç—Ä–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –≤—Å–µ—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π:
- `mipmap-xxxhdpi/` (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
- `mipmap-xxhdpi/`
- `mipmap-xhdpi/`
- –∏ —Ç.–¥.

**–ë–µ–∑ splits**: –≤—Å–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –≤ APK  
**–°–æ splits**: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å  
**–≠–∫–æ–Ω–æ–º–∏—è**: ~500 KB - 1 MB

---

## üì± –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø –í GOOGLE PLAY

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Android App Bundle (AAB)
–í–º–µ—Å—Ç–æ APK –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AAB –¥–ª—è Google Play:
```bash
./gradlew bundleFullRelease
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ AAB**:
- Google Play –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ APK
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π APK –¥–ª—è –∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ù–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ APK –≤—Ä—É—á–Ω—É—é
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Dynamic Delivery

**–§–∞–π–ª**: `app/build/outputs/bundle/fullRelease/app-full-release.aab`

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Splits:

1. **Version Codes**: Gradle –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ versionCode –¥–ª—è –∫–∞–∂–¥–æ–≥–æ split APK
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π APK
3. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è**: –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –≤—Å–µ APK –≤ Google Play Console –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AAB
4. **–≠–º—É–ª—è—Ç–æ—Ä**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `app-full-x86_64-release.apk` –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞

### –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫):
```kotlin
// –í build.gradle.kts —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
splits {
    abi {
        isEnable = false
    }
    density {
        isEnable = false
    }
}
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- [ ] –°–æ–∑–¥–∞–Ω—ã APK –¥–ª—è –≤—Å–µ—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä (arm64-v8a, armeabi-v7a, x86_64)
- [ ] –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ APK ~4-5 MB (–≤–º–µ—Å—Ç–æ 8-10 MB)
- [ ] Universal APK —Å–æ–∑–¥–∞–Ω –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π
- [ ] Lite –≤–µ—Ä—Å–∏—è –µ—â—ë –º–µ–Ω—å—à–µ (~3-4 MB)
- [ ] –í—Å–µ APK –ø–æ–¥–ø–∏—Å–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å keystore)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–°–æ–±–µ—Ä–∏—Ç–µ APK**: `./gradlew assembleFullRelease`
2. **–ò–∑–º–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä—ã**: –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ**: –ó–∞–ø–∏—à–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `OPTIMIZATION_PROGRESS.md`
5. **Commit**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git

---

**–°–æ–∑–¥–∞–Ω–æ**: 30.09.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–∞–∑–º–µ—Ä APK —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 40-50% –¥–ª—è –∫–∞–∂–¥–æ–≥–æ split –≤–∞—Ä–∏–∞–Ω—Ç–∞! üéâ
