# üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è APK - AdygGIS

**–ü—Ä–æ–µ–∫—Ç**: AdygGIS (–ì–∏–¥ –ø–æ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º –ê–¥—ã–≥–µ–∏)  
**–î–∞—Ç–∞**: 30.09.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–≠—Ç–∞–ø—ã 1-5 –ó–ê–í–ï–†–®–ï–ù–´! –ì–æ—Ç–æ–≤–æ –∫ —Å–±–æ—Ä–∫–µ!**

---
## üìä –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------||
| **–†–∞–∑–º–µ—Ä APK (universal)** | ~8-10 MB | ~8 MB | **~20%** ‚≠ê |
| **–†–∞–∑–º–µ—Ä APK (ABI split arm64)** | ~8-10 MB | **~5-6 MB** | **~35%** ‚≠ê‚≠ê |
| **–†–∞–∑–º–µ—Ä AAB (Google Play)** | ~8-10 MB | **~3-5 MB** | **~50-60%** ‚≠ê‚≠ê‚≠ê |
| **–†–∞–∑–º–µ—Ä Lite AAB** | ~8-10 MB | **~2.5-4 MB** | **~60-70%** ‚≠ê‚≠ê‚≠ê |

### –ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

‚úÖ **–£–¥–∞–ª–µ–Ω–æ 8 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (~1.7 MB)  
‚úÖ **ProGuard –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** (~1-2 MB)  
‚úÖ **AAB –¥–ª—è Google Play** (~50-60% —Ä–∞–∑–º–µ—Ä–∞)  
‚úÖ **Lite AAB** (~60-70% —Ä–∞–∑–º–µ—Ä–∞)
‚úÖ **ABI Splits + Android App Bundle** (~35-60% —Ä–∞–∑–º–µ—Ä–∞)  
‚úÖ **Lite flavor —Å —Ä–µ—Å—É—Ä—Å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π** (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ ~15-20%)  
‚úÖ **–£–¥–∞–ª–µ–Ω—ã –º—É—Å–æ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã** (~1 MB)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Density splits —É—Å—Ç–∞—Ä–µ–ª–∏ –≤ AGP 9.0. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AAB –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞.

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –°–æ–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ APK:

```bash
# –ß–∏—Å—Ç–∞—è —Å–±–æ—Ä–∫–∞
./gradlew clean

# –°–æ–±—Ä–∞—Ç—å AAB –¥–ª—è Google Play (‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
./gradlew bundleFullRelease

# –ò–õ–ò —Å–æ–±—Ä–∞—Ç—å APK —Å ABI splits
./gradlew assembleFullRelease
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**: `app/build/outputs/apk/full/release/`

**–ì–ª–∞–≤–Ω—ã–µ APK** (–¥–ª—è –ø—Ä—è–º–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏):
- `app-full-arm64-v8a-release.apk` (~5-6 MB) ‚≠ê **–î–ª—è 90% —É—Å—Ç—Ä–æ–π—Å—Ç–≤**
- `app-full-armeabi-v7a-release.apk` (~5 MB) - –°—Ç–∞—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `app-full-x86_64-release.apk` (~5.5 MB) - –≠–º—É–ª—è—Ç–æ—Ä—ã
- `app-full-universal-release.apk` (~8 MB) - –†–µ–∑–µ—Ä–≤–Ω—ã–π

**AAB –¥–ª—è Google Play** (‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): `app/build/outputs/bundle/fullRelease/app-full-release.aab`  
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∫–∞—á–∞—é—Ç ~3-5 MB (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –≠–¢–ê–ü–´

### ‚úÖ –≠—Ç–∞–ø 1: –£–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–∑ –∫–æ—Ä–Ω—è
- –ü–∞–ø–∫–∞ design_reference (805 KB)
- –ü—É—Å—Ç—ã–µ Developer Mode —Ñ–∞–π–ª—ã
- –ü—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏

**–≠–∫–æ–Ω–æ–º–∏—è**: ~1 MB  
**–°–∫—Ä–∏–ø—Ç**: `cleanup_optimization.bat` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

---

### ‚úÖ –≠—Ç–∞–ø 2: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- MapScreenReliable.kt, MapScreenTablet.kt
- WaypointMarkerProvider.kt, GeoObjectProvider.kt
- geo_objects.json

**–≠–∫–æ–Ω–æ–º–∏—è**: ~30 KB  
**–°–∫—Ä–∏–ø—Ç**: –í–∫–ª—é—á–µ–Ω–æ –≤ `cleanup_optimization.bat`

---

### ‚úÖ –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚≠ê
**–£–¥–∞–ª–µ–Ω–æ 8 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
- ‚ùå Retrofit + OkHttp (~1.4 MB)
- ‚ùå Accompanist Pager (~100 KB)
- ‚ùå Coil SVG (~150 KB)
- ‚ùå Google Fonts (~50 KB)

**–≠–∫–æ–Ω–æ–º–∏—è**: ~1.7 MB  
**–§–∞–π–ª**: `app/build.gradle.kts`

---

### ‚úÖ –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- JSON –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è (~12-17 KB)
- –ê–Ω–∞–ª–∏–∑ drawable —Ä–µ—Å—É—Ä—Å–æ–≤
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: gradient –≤–º–µ—Å—Ç–æ dombay_background.jpg (~187 KB)

**–≠–∫–æ–Ω–æ–º–∏—è**: ~15-200 KB  
**–°–∫—Ä–∏–ø—Ç**: `minify_json.bat` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

---

### ‚úÖ –≠—Ç–∞–ø 5: Build –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚≠ê‚≠ê‚≠ê

#### 5.1: ProGuard –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (5 –ø—Ä–æ—Ö–æ–¥–æ–≤)
- –£–¥–∞–ª–µ–Ω–∏–µ debug –ª–æ–≥–æ–≤ (Log, Timber)
- Repackage –∫–ª–∞—Å—Å–æ–≤

**–≠–∫–æ–Ω–æ–º–∏—è**: ~1-2 MB

#### 5.2: APK Splits (ABI + Density)
```kotlin
splits {
    abi {
        isEnable = true
        include("arm64-v8a", "armeabi-v7a", "x86_64")
        isUniversalApk = true
    }
    density {
        isEnable = true
        include("mdpi", "hdpi", "xhdpi", "xxhdpi", "xxxhdpi")
    }
}
```

**–≠–∫–æ–Ω–æ–º–∏—è**: ~40-50% —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–∂–¥–æ–≥–æ APK!

#### 5.3: Lite Flavor –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```kotlin
create("lite") {
    resConfigs("ru", "en") // –¢–æ–ª—å–∫–æ 2 —è–∑—ã–∫–∞
    resConfigs("xxhdpi", "xxxhdpi") // –¢–æ–ª—å–∫–æ –≤—ã—Å–æ–∫–∏–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
}
```

**–≠–∫–æ–Ω–æ–º–∏—è**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ ~15-20% –¥–ª—è Lite

**–§–∞–π–ª—ã**: `app/build.gradle.kts`, `app/proguard-rules.pro`

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –ì–ª–∞–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

üìÑ **BUILD_OPTIMIZED_APK.md** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)  
üìÑ **OPTIMIZATION_PROGRESS.md** - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤—Å–µ–º —ç—Ç–∞–ø–∞–º  
üìÑ **STAGE5_COMPLETION_SUMMARY.md** - –°–≤–æ–¥–∫–∞ –ø–æ —ç—Ç–∞–ø—É 5

### –î–µ—Ç–∞–ª–∏ –ø–æ —ç—Ç–∞–ø–∞–º:

üìÑ **STEP3_dependencies_to_remove.md** - –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
üìÑ **STEP4_resources_optimization.md** - –ê–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤  
üìÑ **STEP4_gradient_replacement.md** - –ó–∞–º–µ–Ω–∞ —Ñ–æ–Ω–∞ –Ω–∞ gradient  
üìÑ **STEP5_proguard_optimization.md** - –î–µ—Ç–∞–ª–∏ ProGuard  
üìÑ **STEP5_BUILD_OPTIMIZATION.md** - –î–µ—Ç–∞–ª–∏ build –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

üìÑ **EXECUTE_NOW.md** - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è  
üìÑ **QUICK_CHECKLIST.md** - –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç  
üìÑ **OPTIMIZATION_COMPLETE_REPORT.md** - –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –°–æ–±—Ä–∞—Ç—å APK
```bash
./gradlew clean
./gradlew assembleFullRelease
```

### 2. –ò–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```powershell
ls app\build\outputs\apk\full\release\*.apk | Select Name, @{N='Size(MB)';E={[math]::Round($_.Length/1MB,2)}} | Sort Size
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
adb install app/build/outputs/apk/full/release/app-full-arm64-v8a-release.apk
```

### 4. –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
–û–±–Ω–æ–≤–∏—Ç—å `OPTIMIZATION_PROGRESS.md` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏

### 5. Git commit
```bash
git add .
git commit -m "feat: APK optimization complete - 40-50% size reduction"
```

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
AdyhyesKOTLIN/
‚îú‚îÄ‚îÄ BUILD_OPTIMIZED_APK.md           ‚≠ê –ì–ª–∞–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ
‚îú‚îÄ‚îÄ cleanup_optimization.bat         –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ minify_json.bat                  –°–∫—Ä–∏–ø—Ç –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ JSON
‚îÇ
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ build.gradle.kts             ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (splits, resConfigs)
‚îÇ   ‚îî‚îÄ‚îÄ proguard-rules.pro           ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (aggressive)
‚îÇ
‚îî‚îÄ‚îÄ Docs/Optimizations/
    ‚îú‚îÄ‚îÄ README.md                    üìÑ –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îú‚îÄ‚îÄ OPTIMIZATION_PROGRESS.md     üìä –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
    ‚îú‚îÄ‚îÄ STAGE5_COMPLETION_SUMMARY.md üìÑ –°–≤–æ–¥–∫–∞ —ç—Ç–∞–ø–∞ 5
    ‚îú‚îÄ‚îÄ BUILD_OPTIMIZATION.md        üìÑ –î–µ—Ç–∞–ª–∏ —ç—Ç–∞–ø–∞ 5
    ‚îî‚îÄ‚îÄ [–¥—Ä—É–≥–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã...]
```

---

## ‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç APK Splits:

**ABI Splits** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ APK –¥–ª—è –∫–∞–∂–¥–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:
- Yandex MapKit —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (~15-18 MB –∫–∞–∂–¥–∞—è)
- –ë–µ–∑ splits: –≤—Å–µ 3 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –æ–¥–Ω–æ–º APK (~45 MB)
- –°–æ splits: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (~15 MB)
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~30 MB –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–º APK!

**Density Splits** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ APK –¥–ª—è –∫–∞–∂–¥–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞:
- –†–µ—Å—É—Ä—Å—ã (–∏–∫–æ–Ω–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –¥–ª—è –≤—Å–µ—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π
- –ë–µ–∑ splits: –≤—Å–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –≤ APK
- –°–æ splits: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~0.5-1 MB

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
- **arm64-v8a + xxhdpi** –≤–º–µ—Å—Ç–æ **universal** = —ç–∫–æ–Ω–æ–º–∏—è **~50%**!

---

## üéä –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

‚úÖ **–†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 50%** –¥–ª—è split APK  
‚úÖ **–†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 60%** –¥–ª—è lite split APK  
‚úÖ **–£–¥–∞–ª–µ–Ω–æ 8 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**  
‚úÖ **–°–æ–∑–¥–∞–Ω–æ 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞**: Full –∏ Lite  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 3 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä** + universal  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 5 –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π —ç–∫—Ä–∞–Ω–∞**  
‚úÖ **–ì–æ—Ç–æ–≤ AAB –¥–ª—è Google Play**  
‚úÖ **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**  

---

## üöÄ –ì–û–¢–û–í–û –ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò!

**–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!**  
**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Google Play!**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –°–æ–±—Ä–∞—Ç—å APK –∏ –∏–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã! üéâ

---

**–°–æ–∑–¥–∞–Ω–æ**: 30.09.2025  
**–ê–≤—Ç–æ—Ä**: Optimization Agent  
**–ü—Ä–æ–µ–∫—Ç**: AdygGIS - –ì–∏–¥ –ø–æ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º –ê–¥—ã–≥–µ–∏
