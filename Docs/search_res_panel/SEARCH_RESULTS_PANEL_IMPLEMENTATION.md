# Реализация панели результатов поиска для MapScreen

## Обзор
Реализована интерактивная панель результатов поиска для режима карты, которая появляется при вводе текста в строке поиска.

## Компоненты

### 1. CompactAttractionCard.kt
- **Описание**: Компактная карточка достопримечательности (высота 80dp)
- **Особенности**:
  - Круглое фото (56dp)
  - Название и категория
  - Рейтинг со звёздами
  - Минималистичный дизайн

### 2. SearchResultsPanel.kt
- **Описание**: Кастомная панель с результатами поиска, позиционируется относительно клавиатуры
- **Позиционирование**:
  - **С клавиатурой**: Появляется сверху клавиатуры (60% экрана, отступ сверху 120dp)
  - **Без клавиатуры**: Снизу экрана (50% экрана, отступ снизу 80dp)
  - **Скругления**: Адаптивные углы в зависимости от позиции

- **Функциональность**:
  - Автоматическая подстройка позиции под клавиатуру
  - Плавные анимации появления/скрытия (Spring + slideInVertically)
  - Drag handle для визуальной согласованности
  - Счётчик найденных мест
  - Высокий zIndex для отображения поверх карты

### 3. MapViewModel
Добавлены новые состояния и методы:

#### Состояния:
```kotlin
val showSearchPanel: StateFlow<Boolean>
val searchPanelHasKeyboard: StateFlow<Boolean>
val selectedFromPanel: StateFlow<Boolean>
```

#### Методы:
- `selectAttractionFromPanel()` - выбор места из панели с центрированием карты
- `centerMapOnAttraction()` - плавная анимация камеры к месту
- `setSearchPanelVisibility()` - управление видимостью панели
- `setSearchPanelKeyboardState()` - управление состоянием клавиатуры
- `onSearchFieldFocusChanged()` - обработка фокуса поля поиска

### 4. Интеграция в MapScreen
- Панель появляется при фокусе на поле поиска в режиме карты
- Использует WindowInsets.ime.isImeVisible для отслеживания клавиатуры
- Real-time фильтрация результатов
- При выборе места:
  1. Панель скрывается
  2. Карта центрируется на месте
  3. Открывается AttractionBottomSheet
- При закрытии BottomSheet панель возвращается (если был поиск)
- Автоматическое обновление позиции при изменении состояния клавиатуры

## Поток работы

### Сценарий 1: Поиск с клавиатурой
1. Пользователь нажимает на поле поиска
2. Появляется клавиатура
3. Панель выезжает **сверху клавиатуры** (60% экрана)
4. Пользователь вводит текст
5. Результаты фильтруются в реальном времени

### Сценарий 2: Скрытие клавиатуры
1. Пользователь скрывает клавиатуру (свайп вниз или кнопка)
2. Панель анимированно перемещается вниз экрана (50% высоты)
3. Верхняя часть карты становится видимой
4. Панель остается доступной для взаимодействия

### Сценарий 3: Выбор места
1. Пользователь нажимает на карточку места
2. Клавиатура скрывается
3. Панель скрывается
4. Карта плавно центрируется на выбранном месте (1 сек)
5. Открывается AttractionBottomSheet

## Анимации

### Spring анимация для панели:
```kotlin
animationSpec = spring(
    dampingRatio = Spring.DampingRatioLowBouncy,
    stiffness = Spring.StiffnessVeryLow
)
```

### Анимация карточек:
- **Появление**: fadeIn + expandVertically (300ms)
- **Скрытие**: fadeOut + shrinkVertically (200ms)

### Центрирование карты:
```kotlin
Animation(Animation.Type.SMOOTH, 1.0f) // 1 секунда
```

## Настройки и параметры

### Размеры:
- Карточка: высота 80dp
- Фото в карточке: 56dp (круглое)
- Отступы: 12dp внутри карточки
- Расстояние между карточками: 8dp

### Цвета категорий:
- NATURE: #4CAF50
- HISTORY: #795548
- CULTURE: #9C27B0
- ENTERTAINMENT: #FF9800
- RECREATION: #2196F3
- GASTRONOMY: #FFC107
- RELIGIOUS: #607D8B
- ADVENTURE: #FF5722

## Преимущества реализации
1. ✅ Интуитивный UX - панель появляется автоматически при поиске
2. ✅ Адаптивная высота - подстраивается под клавиатуру
3. ✅ Минималистичный дизайн карточек - не перегружает интерфейс
4. ✅ Плавные анимации - профессиональный вид
5. ✅ Интеграция с картой - центрирование и фокусировка
6. ✅ Согласованность - работает синхронно с маркерами на карте

## Время разработки
Примерно 2 часа на полную реализацию и интеграцию.
