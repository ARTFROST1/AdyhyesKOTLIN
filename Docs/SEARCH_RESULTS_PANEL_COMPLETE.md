# –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-04  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ MapScreen  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** SearchResultsPanel.kt, CompactAttractionCard.kt  

## üéØ –û–±–∑–æ—Ä

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∫–∞—Ä—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–∏—Å–∫–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. **SearchResultsPanel.kt**
- **–î–≤—É—Ö—Å—Ç–∞–¥–∏–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Expanded/Half —Å–æ—Å—Ç–æ—è–Ω–∏—è (–±–µ–∑ Hidden –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏)
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£—á–µ—Ç –≤—ã—Å–æ—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (160dp –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å)
- **Drag-–∂–µ—Å—Ç—ã**: –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –æ–±–ª–∞—Å—Ç–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å BottomSheet**: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç Half —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º BottomSheet

#### 2. **CompactAttractionCard.kt**
- **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω**: –í—ã—Å–æ—Ç–∞ 80dp —Å –∫—Ä—É–≥–ª—ã–º —Ñ–æ—Ç–æ 56dp
- **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –ù–∞–∑–≤–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Ä–µ–π—Ç–∏–Ω–≥
- **–¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞

#### 3. **MapViewModel - –†–∞—Å—à–∏—Ä–µ–Ω–∏—è**
- `showSearchPanel: StateFlow<Boolean>` - –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–∞–Ω–µ–ª–∏
- `searchPanelHasKeyboard: StateFlow<Boolean>` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- `selectedFromPanel: StateFlow<Boolean>` - —Ñ–ª–∞–≥ –≤—ã–±–æ—Ä–∞ –∏–∑ –ø–∞–Ω–µ–ª–∏
- `selectAttractionFromPanel()` - –≤—ã–±–æ—Ä –º–µ—Å—Ç–∞ —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–∞—Ä—Ç—ã
- `centerMapOnSearchResults()` - —É–º–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

## üéÆ –°–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ª–æ–≥–∏–∫–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π (–ø–æ —É–±—ã–≤–∞–Ω–∏—é):
1. **!isVisible** ‚Üí Hidden (–ø–æ–∏—Å–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω)
2. **isBottomSheetOpen** ‚Üí Half (BottomSheet –æ—Ç–∫—Ä—ã—Ç - –ø–∞–Ω–µ–ª—å –≤—Å–µ–≥–¥–∞ Half)
3. **hasKeyboard** ‚Üí Expanded (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞)
4. **else** ‚Üí Half (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### –õ–æ–≥–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π:
```kotlin
LaunchedEffect(isVisible, hasKeyboard, isBottomSheetOpen) {
    panelState = when {
        !isVisible -> SearchPanelState.Hidden // Only hide when search is completely dismissed
        isBottomSheetOpen -> SearchPanelState.Half // Always Half when BottomSheet is open
        hasKeyboard -> SearchPanelState.Expanded // Full expansion with keyboard
        else -> SearchPanelState.Half // Default to half state
    }
}
```

### Drag-–∂–µ—Å—Ç—ã:
```kotlin
// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–µ–∂–¥—É Expanded –∏ Half
val newOffset = (offsetY + dragAmount.y).coerceIn(totalTopHeightPx, halfOffset)

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ –ø–æ–∑–∏—Ü–∏–∏
val relativePosition = (offsetY - totalTopHeightPx) / (halfOffset - totalTopHeightPx)
panelState = when {
    relativePosition < 0.5f -> SearchPanelState.Expanded
    else -> SearchPanelState.Half
}
```

## üé¨ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:
```
1. [–ü–æ–∏—Å–∫] ‚Üí –ü–∞–Ω–µ–ª—å: Expanded (—Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π)
2. [Enter/—Å–∫—Ä—ã—Ç–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã] ‚Üí –ü–∞–Ω–µ–ª—å: Half + –∞–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
3. [–ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É] ‚Üí –ü–∞–Ω–µ–ª—å: Half + BottomSheet –ø–æ–≤–µ—Ä—Ö
4. [–ó–∞–∫—Ä—ã—Ç–∏–µ BottomSheet] ‚Üí –ü–∞–Ω–µ–ª—å: Half (–æ—Å—Ç–∞–µ—Ç—Å—è –≤–∏–¥–∏–º–æ–π)
5. [Drag –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑] ‚Üí –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ Expanded ‚Üî Half
6. [–û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞] ‚Üí –ü–∞–Ω–µ–ª—å: Hidden (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è)
```

### –£–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞:
- **–ï—Å—Ç—å —Ç–µ–∫—Å—Ç**: Clear (X) - –æ—á–∏—â–∞–µ—Ç –ø–æ–ª–µ
- **–ü—É—Å—Ç–æ–µ –ø–æ–ª–µ**: Close (X) - –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å –∏ —É–±–∏—Ä–∞–µ—Ç —Ñ–æ–∫—É—Å

## üó∫Ô∏è –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã

### –î–ª—è –æ–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```kotlin
// –°–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –≤–Ω–∏–∑ –Ω–∞ 100–º, —á—Ç–æ–±—ã –º–∞—Ä–∫–µ—Ä –±—ã–ª –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏
val latOffset = 0.001 // ~100m
val targetPoint = Point(
    attraction.location.latitude - latOffset,
    attraction.location.longitude
)
```

### –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```kotlin
// –†–∞—Å—á–µ—Ç —Ü–µ–Ω—Ç—Ä–∞ —Å –æ—Ç—Å—Ç—É–ø–æ–º –≤–≤–µ—Ä—Ö
val centerLat = (minLat + maxLat) / 2.0
val downwardShift = latSpanWithPadding * 0.25 // 25% —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑
val adjustedCenterLat = centerLat - downwardShift

// –£–º–Ω—ã–π –∑—É–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
val zoom = when {
    maxSpan > 0.1 -> 10.0f
    maxSpan > 0.05 -> 12.0f
    maxSpan > 0.01 -> 14.0f
    else -> 15.0f
}
```

## üìê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –†–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **–ó–∞—â–∏—â–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å**: 160dp (—Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ 120dp + —Ñ–∏–ª—å—Ç—Ä—ã 40dp)
- **Expanded –ø–æ–∑–∏—Ü–∏—è**: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç 160dp (–ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- **Half –ø–æ–∑–∏—Ü–∏—è**: 60% —ç–∫—Ä–∞–Ω–∞ –æ—Ç –≤–µ—Ä—Ö–∞
- **–ö–∞—Ä—Ç–æ—á–∫–∞**: –í—ã—Å–æ—Ç–∞ 80dp, —Ñ–æ—Ç–æ 56dp (–∫—Ä—É–≥–ª–æ–µ)
- **–û—Ç—Å—Ç—É–ø—ã**: 12dp –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏, 8dp –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

### –ê–Ω–∏–º–∞—Ü–∏–∏:
- **Spring –∞–Ω–∏–º–∞—Ü–∏—è**: `dampingRatio = LowBouncy` –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è
- **Tween 300ms**: –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è
- **–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã**: 1-1.5 —Å–µ–∫ –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è

### –¶–≤–µ—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
- NATURE: #4CAF50 (–∑–µ–ª–µ–Ω—ã–π)
- HISTORY: #795548 (–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π)
- CULTURE: #9C27B0 (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)
- ENTERTAINMENT: #FF9800 (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- RECREATION: #2196F3 (—Å–∏–Ω–∏–π)
- GASTRONOMY: #FFC107 (–∂–µ–ª—Ç—ã–π)
- RELIGIOUS: #607D8B (—Å–µ—Ä–æ-—Å–∏–Ω–∏–π)
- ADVENTURE: #FF5722 (–∫—Ä–∞—Å–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π)

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í MapScreen.kt:
```kotlin
SearchResultsPanel(
    attractions = filteredAttractions,
    isVisible = showSearchPanel,
    hasKeyboard = isKeyboardVisible,
    isBottomSheetOpen = uiState.showAttractionDetail,
    onAttractionClick = { attraction ->
        viewModel.selectAttractionFromPanel(attraction, mapView)
    },
    onDismiss = {
        viewModel.setSearchPanelVisibility(false)
        keyboardController?.hide()
    }
)
```

### –í MapViewModel.kt:
```kotlin
fun selectAttractionFromPanel(attraction: Attraction, mapView: MapView?) {
    _selectedFromPanel.value = true
    _searchPanelHasKeyboard.value = false // Ensure Half state
    centerMapOnAttraction(attraction, mapView)
    selectAttraction(attraction)
}
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **üéØ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π UX** - –ø–∞–Ω–µ–ª—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
2. **üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ BottomSheet
3. **üé® –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω** - –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
4. **üé¨ –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏** - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥
5. **üó∫Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Ä—Ç–æ–π** - —É–º–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞
6. **üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
7. **üëÜ Drag-–∂–µ—Å—Ç—ã** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
8. **üß† –£–º–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: ~6 —á–∞—Å–æ–≤ (–≤–∫–ª—é—á–∞—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: 2 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞ + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è MapViewModel
- **–°–æ—Å—Ç–æ—è–Ω–∏—è**: –£–ø—Ä–æ—â–µ–Ω–æ –¥–æ 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (Expanded/Half)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç UX –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –±—ã—Å—Ç—Ä—ã–π –∏ —É–¥–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞ –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∫–∞—Ä—Ç—ã.
