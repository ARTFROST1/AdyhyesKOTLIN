# –£–ª—É—á—à–µ–Ω–∏–µ UX –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö - DataUpdateOverlay

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞ `attractions.json` –∫–∞—Ä—Ç–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –ø—É—Å—Ç–æ–π –≤ —Ç–µ—á–µ–Ω–∏–µ 10+ —Å–µ–∫—É–Ω–¥, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø–ª–æ—Ö–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–Ω–∏–º–∞–ª–∏, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å—Ç–∏–ª—å–Ω—ã–π overlay —Å –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. DataUpdateOverlay.kt - –°—Ç–∏–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç overlay

```kotlin
@Composable
fun DataUpdateOverlay(
    isVisible: Boolean,
    progress: Float = 0f,
    modifier: Modifier = Modifier
)
```

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **–ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏**: Fade-in/out —Å slide —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
- **–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
- **–ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞**: –í—Ä–∞—â–∞—é—â–∞—è—Å—è –∏–∫–æ–Ω–∫–∞ CloudSync —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π
- **Material Design 3**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏ –∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–æ–π

#### –°–æ–æ–±—â–µ–Ω–∏—è:
```kotlin
val messages = listOf(
    "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å—ë –¥–ª—è –≤–∞—Å...",
    "–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞...",
    "–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É...",
    "–û—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º —á—É—Ç—å-—á—É—Ç—å!",
    "–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ..."
)
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π MapPreloadManager

#### –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```kotlin
data class PreloadState(
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    val dataUpdating: Boolean = false,  // –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    // ...
)
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏:
```kotlin
init {
    scope.launch {
        preferencesManager.userPreferencesFlow.collect { preferences ->
            val currentVersion = preferences.dataVersion
            if (lastKnownDataVersion != null && lastKnownDataVersion != currentVersion) {
                // –ü–æ–∫–∞–∑–∞—Ç—å overlay –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                _preloadState.value = _preloadState.value.copy(
                    dataUpdating = true,
                    progress = 0.1f
                )
                
                // –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                delay(500)
                _preloadState.value = _preloadState.value.copy(progress = 0.3f)
                
                // –û—á–∏—Å—Ç–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                forceReset()
                VisualMarkerRegistry.forceResetAll()
                
                _preloadState.value = _preloadState.value.copy(progress = 0.7f)
                delay(1000)
                
                // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
                _preloadState.value = _preloadState.value.copy(
                    dataUpdating = false,
                    progress = 1.0f
                )
            }
        }
    }
}
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ MapScreen

```kotlin
// Data update overlay - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö
DataUpdateOverlay(
    isVisible = preloadState?.value?.dataUpdating == true,
    progress = preloadState?.value?.progress ?: 0f,
    modifier = Modifier.fillMaxSize()
)
```

## –ü–æ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞

### –î–æ —É–ª—É—á—à–µ–Ω–∏—è:
```
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ attractions.json
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É
    ‚Üì
–ü—É—Å—Ç–∞—è –∫–∞—Ä—Ç–∞ 10+ —Å–µ–∫—É–Ω–¥ üòû
    ‚Üì
–ú–∞—Ä–∫–µ—Ä—ã –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –Ω–µ–¥–æ—É–º–µ–Ω–∏–∏
```

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:
```
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ attractions.json
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É
    ‚Üì
–°—Ç–∏–ª—å–Ω—ã–π overlay —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å—ë –¥–ª—è –≤–∞—Å..." üòä
    ‚Üì
–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä: 10% ‚Üí 30% ‚Üí 70% ‚Üí 100%
    ‚Üì
–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–µ–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    ‚Üì
–ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ overlay
    ‚Üì
–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    ‚Üì
–û—Ç–ª–∏—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç! üéâ
```

## –í–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã overlay:
1. **–ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω**: `Color.Black.copy(alpha = 0.7f)`
2. **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞**: Material 3 Card —Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏ (24dp)
3. **–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞**: CloudSync —Å –≤—Ä–∞—â–µ–Ω–∏–µ–º –∏ –ø—É–ª—å—Å–∞—Ü–∏–µ–π
4. **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö" (headlineSmall, bold)
5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: –ú–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã —Å fade –∞–Ω–∏–º–∞—Ü–∏–µ–π
6. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä**: LinearProgressIndicator —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
7. **–û–ø–∏—Å–∞–Ω–∏–µ**: –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç –æ –ø—Ä–æ—Ü–µ—Å—Å–µ

### –ê–Ω–∏–º–∞—Ü–∏–∏:
- **–ü–æ—è–≤–ª–µ–Ω–∏–µ**: `fadeIn + slideInVertically` (600ms)
- **–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ**: `fadeOut + slideOutVertically` (400ms)
- **–ò–∫–æ–Ω–∫–∞**: –í—Ä–∞—â–µ–Ω–∏–µ (3000ms) + –ø—É–ª—å—Å–∞—Ü–∏—è (1500ms)
- **–°–æ–æ–±—â–µ–Ω–∏—è**: `fadeIn/fadeOut` (500ms/300ms)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- Overlay —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `dataUpdating = true`
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–π

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å MapPreloadManager
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å PreferencesManager Flow
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–º–Ω—É—é/—Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É

### –û—Ç–ª–∞–¥–∫–∞:
```
üîÑ Data version changed from '1.0.0' to '1.1.0', starting data update process
üßπ Force reset all VisualMarkerProviders
‚úÖ Data update process completed
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:
- ‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- ‚úÖ **–ú–æ—Ç–∏–≤–∞—Ü–∏—è**: –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å
- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º**: –°—Ç–∏–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ**: –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ **–ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Material Design 3
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–ª–∏—á–Ω—ã–π –æ–ø—ã—Ç –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö! üöÄ
