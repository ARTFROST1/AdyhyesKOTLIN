name: 🔍 Release Check

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      branch:
        description: 'Branch to test (default: current branch)'
        required: false
        default: 'release'

jobs:
  build-check:
    name: 🏗️ Build & Test
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: ☕ Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: 🐘 Setup Gradle
      uses: gradle/gradle-build-action@v2
      
    - name: 🗝️ Create local.properties (mock)
      run: |
        echo "YANDEX_MAPKIT_API_KEY=mock_key_for_build_check" > local.properties
        
    - name: 🔧 Make gradlew executable
      run: chmod +x gradlew
      
    - name: 🧹 Clean build
      run: ./gradlew clean
      
    - name: 🔍 Lint check (skip problematic detectors)
      run: ./gradlew lintFullDebug --continue || true
      
    - name: 🏗️ Build Debug APK
      run: ./gradlew assembleFullDebug
      
    - name: 🧪 Run Unit Tests
      run: ./gradlew testFullDebugUnitTest
      
    - name: 📊 Upload build artifacts
      uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: build-reports
        path: |
          app/build/reports/
          app/build/outputs/logs/
